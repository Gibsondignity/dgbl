{% extends 'games/base.html' %}
{% load static %}
{% block title %}Play Puzzle{% endblock %}

{% block content %}

<style>
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .pop-animation {
      animation: pop 0.5s ease;
    }
</style>

<div class="max-w-3xl mx-auto text-center py-10 px-4">
  <h1 class="text-3xl font-bold text-purple-700 mb-6">üß© Let's Solve a Puzzle!</h1>

  <div id="puzzle-container" class="bg-white shadow-lg rounded-xl p-6 min-h-[200px]">
    <!-- Puzzle will load here -->
  </div>

  <div id="feedback" class="mt-4 text-lg font-semibold"></div>

  <button onclick="loadPuzzle()" class="mt-8 bg-purple-500 text-white py-2 px-6 rounded-xl hover:bg-purple-600 transition">
    üîÅ Next Puzzle
  </button>
</div>

<script>
    const correctSound = new Audio("{% static 'sounds/correct.mp3' %}");
  
    function loadPuzzle() {
      fetch("{% url 'get_random_puzzle' %}")
        .then(res => res.json())
        .then(puzzle => {
          const container = document.getElementById("puzzle-container");
          const feedback = document.getElementById("feedback");
          feedback.innerHTML = "";
          container.innerHTML = "";
  
          if (puzzle.error) {
            container.innerHTML = `<p>${puzzle.error}</p>`;
            return;
          }
  
          if (puzzle.type === 'text') {
            container.innerHTML = `
              <p class="text-xl mb-4">${puzzle.question}</p>
              <input id="answer" type="text" class="border p-2 rounded w-full max-w-sm mx-auto" placeholder="Type your answer here">
              <button onclick="checkAnswer('${puzzle.answer}')" class="mt-4 bg-green-500 text-white py-2 px-4 rounded">Submit</button>
            `;
          } else if (puzzle.type === 'image') {
            const optionsHTML = puzzle.options.map(opt => `
              <button onclick="checkAnswer('${puzzle.answer}', '${opt}')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded m-2">${opt}</button>
            `).join('');
            container.innerHTML = `
              <p class="text-xl mb-4">${puzzle.question}</p>
              <img src="${puzzle.image}" alt="Puzzle Image" class="w-48 mx-auto mb-4 rounded shadow">
              <div>${optionsHTML}</div>
            `;
          }
        });
    }
  
    function checkAnswer(correctAnswer, selectedAnswer = null) {
      const answer = selectedAnswer || document.getElementById("answer").value.trim().toLowerCase();
      const isCorrect = answer.toLowerCase() === correctAnswer.toLowerCase();
  
      const feedback = document.getElementById("feedback");
      if (isCorrect) {
        correctSound.play();
        feedback.innerHTML = `<div class="text-green-600 text-xl font-bold pop-animation">üéâ Correct! Great job!</div>`;
      } else {
        feedback.innerHTML = `<div class="text-red-600">‚ùå Oops! Try again or load a new puzzle.</div>`;
      }
    }
  
    document.addEventListener("DOMContentLoaded", loadPuzzle);
  </script>
  

<script>
    const puzzles = [/* ... same as before ... */];
    const correctSound = new Audio("{% static 'sounds/correct.mp3' %}");
  
    function loadPuzzle() {
      const container = document.getElementById("puzzle-container");
      const feedback = document.getElementById("feedback");
      feedback.innerHTML = "";
      container.innerHTML = "";
  
      const puzzle = puzzles[Math.floor(Math.random() * puzzles.length)];
  
      if (puzzle.type === 'text') {
        container.innerHTML = `
          <p class="text-xl mb-4">${puzzle.question}</p>
          <input id="answer" type="text" class="border p-2 rounded w-full max-w-sm mx-auto" placeholder="Type your answer here">
          <button onclick="checkAnswer('${puzzle.answer}')" class="mt-4 bg-green-500 text-white py-2 px-4 rounded">Submit</button>
        `;
      } else if (puzzle.type === 'image') {
        const optionsHTML = puzzle.options.map(opt => `
          <button onclick="checkAnswer('${puzzle.answer}', '${opt}')" class="bg-blue-100 hover:bg-blue-200 p-3 rounded m-2">${opt}</button>
        `).join('');
        container.innerHTML = `
          <p class="text-xl mb-4">${puzzle.question}</p>
          <img src="${puzzle.image}" alt="Puzzle Image" class="w-48 mx-auto mb-4 rounded shadow">
          <div>${optionsHTML}</div>
        `;
      }
    }
  
    function checkAnswer(correctAnswer, selectedAnswer = null) {
      const answer = selectedAnswer || document.getElementById("answer").value.trim().toLowerCase();
      const isCorrect = answer.toLowerCase() === correctAnswer.toLowerCase();
  
      const feedback = document.getElementById("feedback");
      if (isCorrect) {
        correctSound.play();
        feedback.innerHTML = `<div class="text-green-600 text-xl font-bold pop-animation">üéâ Correct! Great job!</div>`;
      } else {
        feedback.innerHTML = `<div class="text-red-600">‚ùå Oops! Try again or load a new puzzle.</div>`;
      }
    }
  
    document.addEventListener("DOMContentLoaded", loadPuzzle);
  </script>
  
{% endblock %}
