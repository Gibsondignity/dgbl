{% extends 'games/base.html' %}
{% block title %}Matching Game{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-6 text-center">
  <h2 class="text-2xl font-bold text-blue-700 mb-4">ðŸ”— Match the Items</h2>
  <p class="text-gray-600 mb-4">Drag and match the items correctly. No pressure â€” just fun!</p>

  <div id="game-container" class="grid grid-cols-2 gap-6 justify-center items-start mt-6">
    <div id="terms" class="space-y-4"></div>
    <div id="matches" class="space-y-4"></div>
  </div>

  <div class="mt-6">
    <button onclick="shuffleGame()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ðŸ”„ New Match</button>
  </div>

  <div id="success" class="hidden mt-6 text-green-600 text-xl font-bold animate-bounce">ðŸŽ‰ You matched everything!</div>
</div>

<script>
const data = [
  { term: "Stethoscope", match: "Used by doctors" },
  { term: "Telescope", match: "Used to see stars" },
  { term: "Calculator", match: "Used for math" }
];

let shuffled = [];

function shuffleGame() {
  document.getElementById('success').classList.add('hidden');
  const terms = [...data].sort(() => Math.random() - 0.5);
  const matches = [...data].sort(() => Math.random() - 0.5);

  document.getElementById('terms').innerHTML = terms.map((item, i) =>
    `<div class="bg-white shadow p-3 rounded draggable" draggable="true" data-term="${item.term}">${item.term}</div>`
  ).join('');

  document.getElementById('matches').innerHTML = matches.map((item, i) =>
    `<div class="bg-yellow-100 p-3 rounded drop-target" data-match="${item.match}">${item.match}</div>`
  ).join('');

  // Drag & Drop
  document.querySelectorAll('.draggable').forEach(el => {
    el.ondragstart = e => e.dataTransfer.setData("text", e.target.dataset.term);
  });

  document.querySelectorAll('.drop-target').forEach(el => {
    el.ondragover = e => e.preventDefault();
    el.ondrop = e => {
      const droppedTerm = e.dataTransfer.getData("text");
      if (data.find(d => d.term === droppedTerm && d.match === el.dataset.match)) {
        el.innerHTML = `âœ… ${droppedTerm}`;
        e.target.classList.add("bg-green-100");
        e.target.classList.remove("bg-yellow-100");
        e.target.ondrop = null;
        e.target.ondragover = null;
        checkWin();
      } else {
        alert("Oops! Try again.");
      }
    };
  });
}

function loadSpellingGame() {
    fetch("/games/api/get-random-spelling/")
      .then(res => res.json())
      .then(data => {
        currentWord = data.word;
        document.getElementById("spelling-input").value = "";
        document.getElementById("spelling-result").classList.add("hidden");
  
        document.getElementById("spelling-image").innerHTML = data.image
          ? `<img src="${data.image}" class="h-32 mx-auto" />`
          : "ðŸ”¤";
  
        if (data.audio) {
          const audio = new Audio(data.audio);
          audio.play();
        }
      });
  }

  
function checkWin() {
  const total = document.querySelectorAll('.drop-target').length;
  const completed = document.querySelectorAll('.drop-target.bg-green-100').length;
  if (total === completed) {
    document.getElementById('success').classList.remove('hidden');
  }
}

shuffleGame();
</script>
{% endblock %}
